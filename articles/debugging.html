<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Debugging • odin2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Debugging">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">odin2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.38</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/odin2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fitting.html">Fitting odin2 models to data</a></li>
    <li><a class="dropdown-item" href="../articles/debugging.html">Debugging</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/errors.html">Odin parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/functions.html">Supported Functions</a></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from odin 1.x.x</a></li>
    <li><a class="dropdown-item" href="../articles/packaging.html">Packaging odin models</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/odin2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Debugging</h1>
                        <h4 data-toc-skip class="author">Rich
FitzJohn</h4>
            
            <h4 data-toc-skip class="date">2025-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/odin2/blob/main/vignettes/debugging.Rmd" class="external-link"><code>vignettes/debugging.Rmd</code></a></small>
      <div class="d-none name"><code>debugging.Rmd</code></div>
    </div>

    
    
<p>Debugging odin models can be challenging because:</p>
<ul>
<li>They’re not composable - you end up with a fairly large set of
equations that govern your system, and you can’t easily split this into
smaller testable units and compose them together.</li>
<li>You are writing in the DSL but the model runs in some other
language; this sometimes behaves unexpectedly and is much less
inspectable than just using R</li>
<li>You can’t (easily) interrupt the running of the program at any point
and inspect it</li>
</ul>
<p>Here, we outline some strategies for debugging, and describe the new
features that aim to make this easier.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/odin2">odin2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/dust2" class="external-link">dust2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="using-print">Using <code>print()</code><a class="anchor" aria-label="anchor" href="#using-print"></a>
</h2>
<p>As of odin 1.4.5, you can print the value of some variables in the
middle of running your model. We will expand and change this
functionality in future versions, your feedback is very welcome.</p>
<p>Consider the simple model below, which illustrates the idea:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu">odin2</span><span class="fu">::</span><span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"x: {x}"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">gen</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_run_to_time.html" class="external-link">dust_system_run_to_time</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [0.000000] x: 0.000000</span></span>
<span><span class="co">#&gt; [1.000000] x: -0.514960</span></span>
<span><span class="co">#&gt; [2.000000] x: -1.023495</span></span>
<span><span class="co">#&gt; [3.000000] x: -1.239498</span></span>
<span><span class="co">#&gt; [4.000000] x: -0.470707</span></span>
<span><span class="co">#&gt; [5.000000] x: 0.898433</span></span>
<span><span class="co">#&gt; [6.000000] x: 0.797199</span></span>
<span><span class="co">#&gt; [7.000000] x: -0.569418</span></span>
<span><span class="co">#&gt; [8.000000] x: -0.342841</span></span>
<span><span class="co">#&gt; [9.000000] x: -1.825629</span></span></code></pre></div>
<p>Here we’ve told odin that we want to watch the variable
<code>x</code> and print its value at every evaluation (the third line
of the model code. When we run the model it prints out the time in
square brackets then the debug information following. Notice that we
only requested the solution at times 0 and 0.1 but the debug information
shows every point in time that the ODE solver evaluated this system of
equations.</p>
<p>While this function shares its name with R’s <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> it
has entirely different functionality.</p>
<div class="section level3">
<h3 id="print-format-strings">
<code>print</code> format strings<a class="anchor" aria-label="anchor" href="#print-format-strings"></a>
</h3>
<p>For print formatting, we use <a href="https://glue.tidyverse.org/" class="external-link">glue</a> to drive the formatting, and
if you have used that package the format will feel familiar.</p>
<p>The most simple usage is as above; you can refer to variables within
<code>{curly braces}</code>; so long as your variable is a scalar this
will work. Outside of curly braces the string is printed verbatim.</p>
<div class="section level4">
<h4 id="conditional-display">Conditional display<a class="anchor" aria-label="anchor" href="#conditional-display"></a>
</h4>
<p>If your model takes many steps, or if you want to narrow down on a
problem, you may want to enable conditional display of your debug
information. Use the argument <code>when =</code> to control display,
such as</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"x: {x}"</span>, when <span class="op">=</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>which will display the value of <code>x</code> when it is greater
than 1. You can chain together expressions with parentheses and
<code>&amp;&amp;</code> or <code>||</code> and reference any value in
your system. For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">printf</span><span class="op">(</span><span class="st">"{x} {y} {z}"</span>, when <span class="op">=</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">&amp;&amp;</span> <span class="va">a</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="controlling-precision">Controlling precision<a class="anchor" aria-label="anchor" href="#controlling-precision"></a>
</h4>
<p>You can control the way that quantities are displayed through the use
of formatting options. The formatting is the same as used by R, so you
can experiment in the console easily. The default is to print as a
generic floating point number, so this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"x: {x}, y: {y}"</span><span class="op">)</span></span></code></pre></div>
<p>is roughly equivalent to writing</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"x: %f, y: %f"</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<p>See <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">?sprintf</a></code> for more information; but this defaults to
6 decimal places of precision. This may not be appropriate if you are
dealing with numbers that are very large or very small; these both look
a bit silly:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"x: %f, y: %f"</span>, <span class="fl">1e-7</span>, <span class="fl">1e7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "x: 0.000000, y: 10000000.000000"</span></span></code></pre></div>
<p>The first loses all information - the only non-zero parts of the
number fall after the precision cut-off, while in the second the 6
decimal places just add noise. So above we might prefer:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"x: %g, y: %g"</span>, <span class="fl">1e-7</span>, <span class="fl">1e7</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "x: 1e-07, y: 1e+07"</span></span></code></pre></div>
<p>which we could write in odin’s approach as</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"x: {x; g}, y: {y; g}"</span><span class="op">)</span></span></code></pre></div>
<p>Anything after the <code>;</code> is interpreted as a format
specifier. You could also do</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"x: {x; g}, y: {y; .2f}"</span><span class="op">)</span></span></code></pre></div>
<p>which would format <code>y</code> to 2 decimal places. We follow here
the example of the <a href="https://glue.tidyverse.org/articles/transformers.html#sprintf-transformer" class="external-link"><code>sprintf</code>
transformer example in glue</a> by not including the <code>%</code>
placeholder, but allow all formats that the underlying library
supports.</p>
</div>
</div>
<div class="section level3">
<h3 id="current-limitations">Current limitations<a class="anchor" aria-label="anchor" href="#current-limitations"></a>
</h3>
<p>This is an experimental interface, and it has not been exposed to
much real-world use. As such it is possible that you might write fairly
innocent looking code and it produce a compiler error rather than a
nicer R error - please let us know so we can fix this.</p>
<ul>
<li>There’s no good way of printing out the contents of an array aside
from indexing into it. That’s possibly a reasonable thing to do though,
given that most arrays get very large very quickly.</li>
<li>You can’t yet control the way that time is formatted (e.g.,
disabling it or changing the precision)</li>
<li>The print statement only runs in your right-hand-side function (ODE
models) or update function (discrete time models) and so it’s possible
that some variables that you refer to in your print statements won’t
exist in this function (e.g., transient quantities used only to compute
some initial condition). We hope this is rare in real-use examples but
welcome minimal examples that show where this causes problems (likely
you will see a compiler error)</li>
<li>We print the result at the end of the rhs/update function; if you
have a crash (or are writing off the end of memory) then this might not
be what you want (e.g., the variables you see are the ones in the
iteration prior to the crash, or after they have been overwritten by
junk). We may support printing more eagerly, after all dependencies in
the expression are satisfied, with an additional option to
<code>print</code>
</li>
<li>Be careful of using integer printing (e.g., <code>{x; d}</code>) for
variables that are merely integer-like, or you will get unexpected junk
output out. You can however write <code>{as.integer(x); d}</code> which
will do a conversion to integer and then print that</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="show-the-generated-code">Show the generated code<a class="anchor" aria-label="anchor" href="#show-the-generated-code"></a>
</h2>
<p>Sometimes just looking at the generated code can be helpful. You can
do this with <code>odin_show</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/odin_show.html">odin_show</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">odin code:</span> <span style="color: #00BBBB;">──────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; #include &lt;dust2/common.hpp&gt;</span></span>
<span><span class="co">#&gt; // [[dust2::class(odin_system)]]</span></span>
<span><span class="co">#&gt; // [[dust2::time_type(discrete)]]</span></span>
<span><span class="co">#&gt; class odin_system {</span></span>
<span><span class="co">#&gt; public:</span></span>
<span><span class="co">#&gt;   odin_system() = delete;</span></span>
<span><span class="co">#&gt;   using real_type = double;</span></span>
<span><span class="co">#&gt;   using rng_state_type = monty::random::generator&lt;real_type&gt;;</span></span>
<span><span class="co">#&gt;   struct shared_state {</span></span>
<span><span class="co">#&gt;     struct odin_internals_type {</span></span>
<span><span class="co">#&gt;       struct {</span></span>
<span><span class="co">#&gt;         dust2::packing state;</span></span>
<span><span class="co">#&gt;       } packing;</span></span>
<span><span class="co">#&gt;       struct {</span></span>
<span><span class="co">#&gt;         std::array&lt;size_t, 1&gt; state;</span></span>
<span><span class="co">#&gt;       } offset;</span></span>
<span><span class="co">#&gt;     } odin;</span></span>
<span><span class="co">#&gt;   };</span></span>
<span><span class="co">#&gt;   struct internal_state {};</span></span>
<span><span class="co">#&gt;   using data_type = dust2::no_data;</span></span>
<span><span class="co">#&gt;   static dust2::packing packing_state(const shared_state&amp; shared) {</span></span>
<span><span class="co">#&gt;     return shared.odin.packing.state;</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static shared_state build_shared(cpp11::list parameters) {</span></span>
<span><span class="co">#&gt;     shared_state::odin_internals_type odin;</span></span>
<span><span class="co">#&gt;     odin.packing.state = dust2::packing{</span></span>
<span><span class="co">#&gt;       {"x", {}}</span></span>
<span><span class="co">#&gt;     };</span></span>
<span><span class="co">#&gt;     odin.packing.state.copy_offset(odin.offset.state.begin());</span></span>
<span><span class="co">#&gt;     return shared_state{odin};</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static internal_state build_internal(const shared_state&amp; shared) {</span></span>
<span><span class="co">#&gt;     return internal_state{};</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static void update_shared(cpp11::list parameters, shared_state&amp; shared) {</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static void update_internal(const shared_state&amp; shared, internal_state&amp; internal) {</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static void initial(real_type time, const shared_state&amp; shared, internal_state&amp; internal, rng_state_type&amp; rng_state, real_type* state) {</span></span>
<span><span class="co">#&gt;     state[0] = 0;</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt;   static void update(real_type time, real_type dt, const real_type* state, const shared_state&amp; shared, internal_state&amp; internal, rng_state_type&amp; rng_state, real_type* state_next) {</span></span>
<span><span class="co">#&gt;     const auto x = state[0];</span></span>
<span><span class="co">#&gt;     state_next[0] = monty::random::normal&lt;real_type&gt;(rng_state, x, 1);</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; };</span></span></code></pre></div>
<p>To show just a particular method (usually <code>update</code> or
<code>rhs</code>), use the <code>what</code> argument, for example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/odin_show.html">odin_show</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span>, what <span class="op">=</span> <span class="st">"update"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">odin code (update):</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; static void update(real_type time, real_type dt, const real_type* state, const shared_state&amp; shared, internal_state&amp; internal, rng_state_type&amp; rng_state, real_type* state_next) {</span></span>
<span><span class="co">#&gt;   const auto x = state[0];</span></span>
<span><span class="co">#&gt;   state_next[0] = monty::random::normal&lt;real_type&gt;(rng_state, x, 1);</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-the-interactive-debugger">Use the interactive debugger<a class="anchor" aria-label="anchor" href="#use-the-interactive-debugger"></a>
</h2>
<p>This is new and very experimental, you can ask odin to drop you into
a debugger (implemented on top of R’s <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> to explore
the values of your variables at some point within a model run. To do
this, add a call to <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> somewhere within your odin
code and recompile.</p>
<p>The <code>browser</code> function in odin accepts arguments</p>
<ul>
<li>
<code>phase</code>: the system phase where the debugger should be
inserted; this will typically be <code>update</code> or
<code>deriv</code>
</li>
<li>
<code>when</code>: optionally a condition that should be satisfied
for the debugger to be triggered. You will typically want to set this or
it will be called at every step</li>
</ul>
<p>Note that these are not the same as R’s <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code>!</p>
<p>For example, to debug the simple SIR model from
<code>vignette("odin")</code> we might write:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/odin.html">odin</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">p_IR</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">dt</span><span class="op">)</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="va">p_SI</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">beta</span> <span class="op">*</span> <span class="va">I</span> <span class="op">/</span> <span class="va">N</span> <span class="op">*</span> <span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">n_SI</span> <span class="op">&lt;-</span> <span class="fu">Binomial</span><span class="op">(</span><span class="va">S</span>, <span class="va">p_SI</span><span class="op">)</span></span>
<span>  <span class="va">n_IR</span> <span class="op">&lt;-</span> <span class="fu">Binomial</span><span class="op">(</span><span class="va">I</span>, <span class="va">p_IR</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">S</span> <span class="op">-</span> <span class="va">n_SI</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I</span> <span class="op">+</span> <span class="va">n_SI</span> <span class="op">-</span> <span class="va">n_IR</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">R</span> <span class="op">+</span> <span class="va">n_IR</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">S</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">N</span> <span class="op">-</span> <span class="va">I0</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">I</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">I0</span></span>
<span>  <span class="fu">initial</span><span class="op">(</span><span class="va">R</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span></span>
<span>  <span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="va">I0</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser</a></span><span class="op">(</span>phase <span class="op">=</span> <span class="st">"update"</span>, when <span class="op">=</span> <span class="va">I</span> <span class="op">&lt;</span> <span class="fl">10</span> <span class="op">&amp;&amp;</span> <span class="va">time</span> <span class="op">&gt;</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The location of the call to <code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> does not matter;
it will be activated at the <strong>end</strong> of the phase. The
condition here might be something we cook up to look at what happens as
the number of individuals in the infected class starts tailing off at
the end of the simulation.</p>
<p>We create and initialise the system as normal:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">gen</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></code></pre></div>
<p>However, when you run the system you will pause part way through
evaluation:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_run_to_time.html" class="external-link">dust_system_run_to_time</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">200</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ dust browser ('update'; time = 117): see `?dust_browser()` for help</span></span>
<span><span class="co">#&gt; Called from: eval(substitute(expr), data, enclos = parent.frame())</span></span></code></pre></div>
<p>and the prompt has changed to <code>Browse[1]&gt;</code>
(unfortunately we can’t change this easily)</p>
<p>Here, you can see the things that odin and dust know about:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> <span class="fu">ls</span>()</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">"beta"</span>  <span class="st">"gamma"</span> <span class="st">"I"</span>     <span class="st">"I0"</span>    <span class="st">"N"</span>     <span class="st">"n_IR"</span>  <span class="st">"n_SI"</span>  <span class="st">"p_IR"</span>  <span class="st">"p_SI"</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>[<span class="dv">10</span>] <span class="st">"R"</span>     <span class="st">"S"</span>     <span class="st">"time"</span></span></code></pre></div>
<p>and you can inspect values or perform calculations:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> N</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1000</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> I</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">9</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> S</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">178</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>Browse[<span class="dv">1</span>]<span class="sc">&gt;</span> I <span class="sc">/</span> S</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.0505618</span></span></code></pre></div>
<p>If you press <code>c</code> or <code>n</code>, then odin the system
will proceed to the next step and drop you back into the debugger. You
can exit with <code>Q</code> which will return you to the console with
an error. You can also run</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_browser.html" class="external-link">dust_browser_continue</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>and then press <code>c</code> to continue to the end of your
simulation.</p>
<p>Changes that you make to variables within the debugger are
<em>not</em> (currently) reflected back into the model. We’d be very
happy to discuss this sort of workflow if it seems useful.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
