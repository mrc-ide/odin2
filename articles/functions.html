<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Supported Functions • odin2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Supported Functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">odin2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.38</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/odin2.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fitting.html">Fitting odin2 models to data</a></li>
    <li><a class="dropdown-item" href="../articles/debugging.html">Debugging</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/errors.html">Odin parse errors</a></li>
    <li><a class="dropdown-item" href="../articles/functions.html">Supported Functions</a></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from odin 1.x.x</a></li>
    <li><a class="dropdown-item" href="../articles/packaging.html">Packaging odin models</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/odin2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Supported Functions</h1>
                        <h4 data-toc-skip class="author">Rich
FitzJohn</h4>
            
            <h4 data-toc-skip class="date">2025-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/odin2/blob/main/vignettes/functions.Rmd" class="external-link"><code>vignettes/functions.Rmd</code></a></small>
      <div class="d-none name"><code>functions.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="general-syntax">General syntax<a class="anchor" aria-label="anchor" href="#general-syntax"></a>
</h2>
<p><code>odin</code> is a “<a href="https://en.wikipedia.org/wiki/Domain-specific_language" class="external-link">Domain
Specific Language</a>”; a mini-language that solves a specific problem;
in this case representing systems of difference or differential
equations. It is syntactically R (i.e., it can be parsed with R’s
parser) but it is not itself R. Only a subset of expressions and syntax
are supported.</p>
<p>Every line in <code>odin</code> code must be an
<strong>assignment</strong> or a <strong>relationship</strong> (there
are some minor exceptions below).</p>
<p>An assignment looks like</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">expression</span></span></code></pre></div>
<p>while a relationship looks like</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b</span> <span class="op">~</span> <span class="fu">Distribution</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>where <code>b</code> will be an entry from data (introduced by
<code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>), <code>Distribution</code> will be a monty
distribution function (see below), and <code>...</code> will be
arguments to this function, which might come from data or from model
variables. See <code><a href="../articles/fitting.html">vignette("fitting")</a></code> for a high-level
introduction to this interface.</p>
<p><code>odin2</code> supports many functions that you’d expect to see
for constructing dynamical models. These include most common
mathematical operations and some that are quite obscure. The support for
stochastic models and comparison to data comes from
<code>monty</code>.</p>
</div>
<div class="section level2">
<h2 id="variables">Variables<a class="anchor" aria-label="anchor" href="#variables"></a>
</h2>
<p>Conceptually, a system is entirely determined by its
<strong>variables</strong>; these are the state of the system.</p>
<ul>
<li>for continuous time (ODE) models, these are the equations that you
have time derivatives for, represented by <code><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv()</a></code> on the
left-hand-side of an assignment</li>
<li>for discrete time models, these are the equations that you have
<code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> expressions for, for describing the recurrence
relation.</li>
</ul>
<p>Practically, we actually determine the variables of a system based on
the presence of an <code>initial()</code> call on the left hand side, as
this will be present for both continuous-time and discrete-time
systems.</p>
<p>The simplest ODE system might be:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html" class="external-link">deriv</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">x</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>which describes some sort of logarithmic growth in
<code>x</code>.</p>
<p>Similarly, a trivial discrete-time system might be</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="fu">initial</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p>which describes a counter.</p>
<div class="section level3">
<h3 id="continuous-time-models">Continuous time models<a class="anchor" aria-label="anchor" href="#continuous-time-models"></a>
</h3>
<p>There are two special considerations for ODE models.</p>
<p>First, we allow additional “variables” as output; these are
quantities for which you do not have derivatives and are computed from
your true variables and other quantities in the model, but which are
considered state for the purposes of input and output. You can specify
output by writing:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">output</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre></div>
<p>which would define a new variable <code>y</code> which takes on the
value of <code>x * 2</code>. When passing state into or out of a system
<code>y</code> would be included even though it is computable from
<code>x</code>. Alternatively, if <code>y</code> is something that you
are already using within the model you can write:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">output</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>You may want to use these to inspect intermediates in an ODE model,
or to reduce the amount of state you need to save from
<code>simulate</code> etc (for example you may want to output the sum
over some disaggregated set of variables for which you actually have
derivatives).</p>
<p>Second, if your system has delays, then there is implicit state in
the history of these delays. Delays start off life empty and are filled
up as the system runs. This means that continuing a delayed system is
not the same as starting a delayed system from a particular point in
space/time, and we will provide tools for working with this in future
versions.</p>
</div>
</div>
<div class="section level2">
<h2 id="basic-operations">Basic operations<a class="anchor" aria-label="anchor" href="#basic-operations"></a>
</h2>
<ul>
<li>
<code>+</code> – <strong>Plus</strong>: Both infix
(<code>a + b</code>) and prefix (<code>+a</code>) versions supported
(e.g., <code>1 + 2</code> → <code>3</code>)</li>
<li>
<code>-</code> – <strong>Minus</strong>: Both infix
(<code>a - b</code>) and prefix (<code>-a</code>) versions supported
(e.g., <code>10 - 1</code> → <code>9</code>)</li>
<li>
<code>*</code> – <strong>Multiply</strong>: Multiply two numbers
together (e.g., <code>2 * 6</code> → <code>12</code>)</li>
<li>
<code>/</code> – <strong>Divide</strong>: Divide two numbers (e.g.,
<code>12 / 6</code> → <code>2</code>)</li>
<li>
<code>^</code> – <strong>Power</strong>: Raise the first number to
the power of the second. Either number may be a floating point number
(e.g., <code>2.3 ^ 1.2</code> → <code>2.716898</code>)</li>
<li>
<code>(</code> – <strong>Parenthesis</strong>: Group expressions
together (e.g., <code>(1 + 5) * 2</code> → <code>12</code>)</li>
</ul>
</div>
<div class="section level2">
<h2 id="conditionals">Conditionals<a class="anchor" aria-label="anchor" href="#conditionals"></a>
</h2>
<p>You can only use conditionals with <code>if</code> as an inline
expression, for example</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fl">9</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="fl">1</span> <span class="kw">else</span> <span class="fl">2</span></span></code></pre></div>
<p>would result in <code>a</code> being assigned as <code>2</code> (this
works in R normally too!).</p>
<p>Because general flow control is not supported, you
<strong>cannot</strong> write:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fl">9</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="operators">Operators<a class="anchor" aria-label="anchor" href="#operators"></a>
</h2>
<p>A number of logical-returning operators exist, primarily to support
the <code>if</code> statement; all the usual comparison operators exist
(though not vectorised <code>|</code> or <code>&amp;</code>).</p>
<ul>
<li>
<code>&gt;</code> – <strong>Greater than</strong> (e.g.,
<code>1 &gt; 2</code> → <code>FALSE</code>)</li>
<li>
<code>&lt;</code> – <strong>Less than</strong> (e.g.,
<code>1 &lt; 2</code> → <code>TRUE</code>)</li>
<li>
<code>&gt;=</code> – <strong>Greater than or equal to</strong>
(e.g., <code>1 &gt;= 2</code> → <code>FALSE</code>)</li>
<li>
<code>&lt;=</code> – <strong>Less than or equal to</strong> (e.g.,
<code>1 &lt;= 2</code> → <code>TRUE</code>)</li>
<li>
<code>==</code> – <strong>Is exactly equal to</strong> (e.g.,
<code>1 == 1</code> → <code>TRUE</code>)</li>
<li>
<code>!=</code> – <strong>Is not exactly equal to</strong> (e.g.,
<code>1 != 2</code> → <code>TRUE</code>)</li>
<li>
<code>&amp;&amp;</code> – <strong>Boolean AND</strong> (e.g.,
<code>(1 == 1) &amp;&amp; (2 &gt; 1)</code> → <code>TRUE</code>)</li>
<li>
<code>||</code> – <strong>Boolean OR</strong> (e.g.,
<code>(1 == 1) &amp;&amp; (2 &gt; 1)</code> → <code>TRUE</code>)</li>
</ul>
<p>Be wary of strict equality with <code>==</code> or <code>!=</code> as
numbers may be floating point numbers, which have some surprising
properties for the uninitiated, for example</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">==</span> <span class="fl">3</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="mathematical-functions-and-constants">Mathematical functions and constants<a class="anchor" aria-label="anchor" href="#mathematical-functions-and-constants"></a>
</h2>
<ul>
<li>
<code>%%</code> – <strong>Modulo</strong>: Finds the remainder after
division of one number by another (e.g., <code>123 %% 100</code> →
<code>23</code>)</li>
<li>
<code>%/%</code> – <strong>Integer divide</strong>: Different to
floating point division, effectively the full number of times one number
divides into another (e.g., <code>20 %/% 7</code> → <code>2</code>)</li>
<li>
<code>abs</code> – <strong>Absolute value</strong> (e.g.,
<code>abs(-1)</code> → <code>1</code>)</li>
<li>
<code>sign</code> – <strong>Sign function</strong>: Returns the sign
of its argument as either -1, 0 or 1, which may be useful for
multiplying by another argument (e.g., <code>sign(-100)</code> →
<code>-1</code>)</li>
<li>
<code>round</code> – <strong>Round a number</strong> (e.g.,
<code>round(1.23)</code> → <code>1</code>; <code>round(1.23, 1)</code> →
<code>1.2</code>)</li>
<li>
<code>floor</code> – <strong>Floor of a number</strong>: Largest
integer not greater than the provided number (e.g.,
<code>floor(6.5)</code> → <code>6</code>)</li>
<li>
<code>ceiling</code> – <strong>Ceiling of a number</strong>:
Smallest integer not less than the provided number (e.g.,
<code>ceiling(6.5)</code> → <code>7</code>)</li>
<li>
<code>trunc</code> – <strong>Truncate a number</strong>: Round a
number towards zero</li>
<li>
<code>max</code> – <strong>Maximum</strong>: Returns maximum of two
numbers (e.g., <code>max(2, 6)</code> → <code>6</code>)</li>
<li>
<code>min</code> – <strong>Minimum</strong> (e.g.,
<code>min(2, 6)</code> → <code>2</code>)</li>
<li>
<code>exp</code> – <strong>Exponential function</strong> (e.g.,
<code>exp(1)</code> → <code>2.718282</code>)</li>
<li>
<code>expm1</code> – <strong>Computes exp(x) - 1 accurately for
small |x|</strong> (e.g., <code>exp(1)</code> →
<code>1.718282</code>)</li>
<li>
<code>log</code> – <strong>Logarithmic function in base e</strong>
(e.g., <code>log(1)</code> → <code>0</code>)</li>
<li>
<code>log2</code> – <strong>Logarithmic function in base 2</strong>
(e.g., <code>log2(1024)</code> → <code>10</code>)</li>
<li>
<code>log10</code> – <strong>Logarithmic function in base
10</strong> (e.g., <code>log10(1000)</code> → <code>3</code>)</li>
<li>
<code>log1p</code> – <strong>Computes log(x + 1) accurately for
small |x|</strong> (e.g., <code>log1p(1)</code> →
<code>0.6931472</code>)</li>
<li>
<code>sqrt</code> – <strong>Square root function</strong> (e.g.,
<code>sqrt(4)</code> → <code>2</code>)</li>
<li>
<code>beta</code> – <strong>Beta function</strong> (e.g.,
<code>beta(3, 5)</code> → <code>0.00952381</code>)</li>
<li>
<code>lbeta</code> – <strong>Log beta function</strong> (e.g.,
<code>lbeta(3, 5)</code> → <code>-4.65396</code>)</li>
<li>
<code>choose</code> – <strong>Binomial coefficients</strong> (e.g.,
<code>choose(60, 3)</code> → <code>34220</code>)</li>
<li>
<code>lchoose</code> – <strong>Log binomial coefficients</strong>
(e.g., <code>choose(60, 3)</code> → <code>10.44057</code>)</li>
<li>
<code>gamma</code> – <strong>Gamma function</strong> (e.g.,
<code>gamma(10)</code> → <code>362880</code>)</li>
<li>
<code>lgamma</code> – <strong>Log gamma function</strong> (e.g.,
<code>lgamma(10)</code> → <code>12.80183</code>)</li>
</ul>
<p>The exact behaviour for <code>%%</code> and <code>%/%</code> for
floating point numbers and negative numbers is complicated - please see
<code><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">?Arithmetic</a></code>. The rules for operators in <code>odin</code>
try to follow those in R as closely as possible.</p>
<p>The constant <code>pi</code> can be used, along with all the usual
trig functions:</p>
<ul>
<li>
<code>cos</code> – <strong>Cosine function</strong>
</li>
<li>
<code>sin</code> – <strong>Sine function</strong>
</li>
<li>
<code>tan</code> – <strong>Tangent function</strong>
</li>
<li>
<code>acos</code> – <strong>Arc-cosine function</strong>
</li>
<li>
<code>asin</code> – <strong>Arc-sin function</strong>
</li>
<li>
<code>atan</code> – <strong>Arc-tangent function</strong>
</li>
<li>
<code>atan2</code> – <strong>Two-argument arc-tangent
function</strong>
</li>
<li>
<code>cosh</code> – <strong>Hyperbolic cosine function</strong>
</li>
<li>
<code>sinh</code> – <strong>Hyperbolic sine function</strong>
</li>
<li>
<code>tanh</code> – <strong>Hyperbolic tangent
function</strong>
</li>
<li>
<code>acosh</code> – <strong>Hyperbolic arc-cosine
function</strong>
</li>
<li>
<code>asinh</code> – <strong>Hyperbolic arc-sine
function</strong>
</li>
<li>
<code>atanh</code> – <strong>Hyperbolic arc-tangent
function</strong>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="arrays">Arrays<a class="anchor" aria-label="anchor" href="#arrays"></a>
</h2>
<p>Use of arrays implies a “<code>for</code>-loop” in the generated
code. For example, you might write a vectorised version of the <a href="https://en.wikipedia.org/wiki/Logistic_map" class="external-link">logistic map</a>
as:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>which will expand to code equivalent to</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">y_next</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">r</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The loop extent here (over the entire range of <code>y</code>) is
determined by the left hand side expression (<code>y[]</code>). This
enables use of <code>i</code> on the right hand side to index as loop
progresses.</p>
<p>The indices on the right hand side can be <code>i</code>,
<code>j</code>, <code>k</code>, <code>l</code>, <code>i5</code>,
<code>i6</code>, <code>i7</code> or <code>i8</code> (odin supports
arrays up to 8 dimensions: do let us know if you need more for some
reason).</p>
<p>Arrays can have more than one dimension, for example the
expression:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ay</span><span class="op">[</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span></code></pre></div>
<p>involves loops over two dimensions because we loop over the whole
extent of <code>ay</code> which is a matrix. This is roughly equivalent
to:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ay</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ay</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="va">ay</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note here that <code>y</code> is accessed using <code>j</code>, even
though it is only a vector. This is because the loop extents are
generated by the left hand side.</p>
<div class="section level3">
<h3 id="array-size">Array size<a class="anchor" aria-label="anchor" href="#array-size"></a>
</h3>
<p>Every array variable requires a <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code>
<strong>assignment</strong>. For example, in the above examples we might
have:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ay</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nr</span>, <span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<p>where <code>y</code> is defined to be a 1-dimensional array of length
10 and <code>ay</code> is a matrix (2-dimensional array) with
<code>nr</code> rows and <code>nc</code> columns. The extents of arrays
must be determined at the <strong>first</strong> system initialisation,
and this is checked during parse.</p>
<p>If you have different arrays with the same dimensions, you can also
use <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code> on the right-hand side, to copy from an array you
have set the dimensions of elsewhere. For <a href="example:-" class="uri">example:-</a></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span></span></code></pre></div>
<p>You can also combine arrays on the left-hand side to group arrays
with the same dimensions together. These 5 arrays will all have the same
dimensions:-</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">c</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="special-functions-for-arrays">Special functions for arrays<a class="anchor" aria-label="anchor" href="#special-functions-for-arrays"></a>
</h3>
<p>We provide several functions for retrieving dimensions from an
array</p>
<ul>
<li>
<code>length</code> – <em>Length</em>: get the full length of an
array. For a single dimensional array this is obvious, for a
multidimensional array it is the product over all dimensions.</li>
<li>
<code>nrow</code> – <em>Number of rows</em>: number of rows in a
matrix or number of elements in the first dimension of a
multidimensional array</li>
<li>
<code>ncol</code> – <em>Number of columns</em>: number of columns in
a matrix or number of elements in the second dimension of a
multidimensional array</li>
</ul>
<p>We do not currently offer a function for accessing the size of higher
dimensions, please let us know if this is an issue (see
<code><a href="../articles/migrating.html">vignette("migrating")</a></code>)</p>
<p>Frequently, you will want to take a sum over an array, or part of an
array, using <code>sum</code>. To sum over all elements of an array, use
<code><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum()</a></code> with the name of the array you would like to sum
over:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">x_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>If <code>m</code> is a matrix you can compute the sums over the
second column by writing:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>This partial sum approach is frequently used within implicit
loops:</p>
<pre><code><span><span class="va">m_col_totals</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>You can use this approach to compute a matrix-vector product
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">(</mi><mi>A</mi><mi>x</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\mathbf(Ax)</annotation></semantics></math>:</p>
<pre><code><span><span class="va">ax_tmp</span><span class="op">[</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span><span class="va">ax</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">a</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="distribution-functions">Distribution functions<a class="anchor" aria-label="anchor" href="#distribution-functions"></a>
</h2>
<p>We support distribution functions in two places:</p>
<p>First, for discrete-time models we support sampling from a
distribution at each time step. For example:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>will assign <code>a</code> to a draw from the standard normal
distribution. You cannot use these functions from continuous time
models. You cannot sample from stochastic functions in a continuous time
(ODE) model.</p>
<p>Second, for comparison to data, for example:</p>
<pre><code><span><span class="va">a</span> <span class="op">~</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
<p>will add a log likelihood term looking up the log density of the data
element <code>a</code> against a standard normal distribution. This form
can be used in both discrete-time and continuous-time models. For more
information, see <code><a href="../articles/fitting.html">vignette("fitting")</a></code>.</p>
<p>Some distributions have several versions; these are distinguished by
the arguments to the functions. For example:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>draw from a Gamma distribution with a shape of 2 and a
<strong>rate</strong> of 0.1, while</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span><span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">Gamma</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">2</span>, scale <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>draw from a Gamma distribution with a shape of 2 and a
<strong>scale</strong> of 10.</p>
<p>The currently supported distributions are (alphabetically):</p>
<ul>
<li>
<code>Beta</code> – the <a href="https://en.wikipedia.org/wiki/Beta_distribution" class="external-link">beta
distribution</a> with parameters <code>a</code> and <code>b</code> (vs
<code>rbeta</code>’s <code>shape1</code> and <code>shape2</code>)</li>
<li>
<code>BetaBinomial</code> – the <a href="https://en.wikipedia.org/wiki/Beta-binomial_distribution" class="external-link">beta-binomial
distribution</a> with two forms:
<ul>
<li>
<code>size</code>, <code>prob</code> (the mean probability of
success), <code>rho</code> (dispersion parameter)
(<strong>default</strong>)</li>
<li>
<code>size</code>, <code>a</code>, <code>b</code>
</li>
</ul>
</li>
<li>
<code>Binomial</code> – the <a href="https://en.wikipedia.org/wiki/Binomial_distribution" class="external-link">binomial
distribution</a> with parameters <code>size</code> and
<code>prob</code>
</li>
<li>
<code>Cauchy</code> – the <a href="https://en.wikipedia.org/wiki/Cauchy_distribution" class="external-link">Cauchy
distribution</a> with parameters <code>location</code> and
<code>scale</code>. Note that as the Cauchy distribution does not have a
defined mean, you can not run a model with Cauchy draws in <a href="https://mrc-ide.github.io/odin2/articles/fitting.html#deterministic-models-from-stochastic">deterministic
mode</a>.</li>
<li>
<code>Exponential</code> – the <a href="https://en.wikipedia.org/wiki/Exponential_distribution" class="external-link">exponential
distribution</a> with two forms:
<ul>
<li>
<code>rate</code> (<strong>default</strong>); this is the same
parameterisation as <code>rexp</code>
</li>
<li>
<code>mean</code> which is the inverse of rate.
<strong>NOTE</strong>: we may change this to <code>scale</code>
soon</li>
</ul>
</li>
<li>
<code>Gamma</code> – the <a href="https://en.wikipedia.org/wiki/Gamma_distribution" class="external-link">gamma
distribution</a> with two forms:
<ul>
<li>
<code>shape</code>, <code>rate</code>
(<strong>default</strong>)</li>
<li>
<code>shape</code>, <code>scale</code>
</li>
</ul>
</li>
<li>
<code>Hypergeometric</code> – the <a href="https://en.wikipedia.org/wiki/Hypergeometric_distribution" class="external-link">hypergeometric
distribution</a> with parameters <code>m</code> (number of white balls),
<code>n</code> (number of black balls), and <code>k</code> (number of
samples), and we return the number of <em>white</em> balls. We may
support alternative parametrisations of this distribution in future
(this version is the same parametrisation as <code>rhyper</code>)</li>
<li>
<code>LogNormal</code> – the <a href="https://en.wikipedia.org/wiki/Log-normal_distribution" class="external-link">log-normal
distribution</a> with parameters <code>meanlog</code> and
<code>sdlog</code>, the mean and standard deviation of the distribution
on the log scale</li>
<li>
<code>NegativeBinomial</code> – the <a href="https://en.wikipedia.org/wiki/Negative_binomial_distribution" class="external-link">negative
binomial distribution</a> with two forms:
<ul>
<li>
<code>size</code>, <code>prob</code> (<strong>default</strong>)</li>
<li>
<code>size</code>, <code>mu</code> (the mean)</li>
</ul>
</li>
<li>
<code>Normal</code> – the <a href="https://en.wikipedia.org/wiki/Normal_distribution" class="external-link">normal
distribution</a> with parameters <code>mean</code>, <code>sd</code>
</li>
<li>
<code>Poisson</code> – the <a href="https://en.wikipedia.org/wiki/Poisson_distribution" class="external-link">Poisson
distribution</a> with parameter <code>lambda</code> (the mean)</li>
<li>
<code>TruncatedNormal</code> – the <a href="https://en.wikipedia.org/wiki/Truncated_normal_distribution" class="external-link">truncated
normal distribution</a> with parameters <code>mean</code>,
<code>sd</code>, <code>min</code> and <code>max</code>. For a one-sided
truncated normal distribution, you can set <code>min = -Inf</code> or
<code>max = Inf</code>. Note that <code>mean</code> and <code>sd</code>
are not the mean and standard deviation of the truncated normal
distribution, but are the mean and standard deviation of the normal
distribution that has been truncated.</li>
<li>
<code>Uniform</code> – the <a href="https://en.wikipedia.org/wiki/Uniform_distribution" class="external-link">uniform
distribution</a> with parameters <code>min</code> and
<code>max</code>
</li>
<li>
<code>Weibull</code> – the <a href="https://en.wikipedia.org/wiki/Weibull_distribution" class="external-link">Weibull
distribution</a> with parameters <code>shape</code> and
<code>scale</code>
</li>
<li>
<code>ZINegativeBinomial</code> – the <a href="https://en.wikipedia.org/wiki/Zero-inflated_model" class="external-link">zero-inflated</a>
negative binomial distribution. With probability <code>pi0</code> a 0 is
drawn, otherwise we draw from the corresponding standard negative
binomial distribution using the other parameters (which may also result
in a 0 being drawn). As with the standard negative binomial
distribution, there are two forms:
<ul>
<li>
<code>pi0</code>, <code>size</code>, <code>prob</code>
(<strong>default</strong>)</li>
<li>
<code>pi0</code>, <code>size</code>, <code>mu</code> (the mean of
the negative binomial part of the distribution - note that the mean of
the zero-inflated negative binomial distribution will be
<code>(1 - pi0) * mu</code>).</li>
</ul>
</li>
<li>
<code>ZIPoisson</code> – the <a href="https://en.wikipedia.org/wiki/Zero-inflated_model" class="external-link">zero-inflated</a>
Poisson distribution. with parameters <code>pi0</code> (the probability
of excess zeros) and <code>lambda</code> (the mean of the Poisson part
of the distribution). With probability <code>pi0</code> a 0 is drawn,
otherwise we draw from the corresponding standard Poisson distribution
with mean <code>lambda</code> (which may also result in a 0 being
drawn). Note the mean of this distribution is
<code>(1 - pi0) * lambda</code>.</li>
</ul>
<p>In the future, we plan support for additional distributions, please
let us know if we are missing any that you need. The support for these
functions comes from <code>monty</code> and we will link here to the
docs in that package once they exist for additional details.</p>
<p>We plan to explicitly support the <a href="https://en.wikipedia.org/wiki/Multinomial_distribution" class="external-link">multinomial
distribution</a> in future, but for the time being it can be implemented
as a loop of nested binomial distributions. For instance if you want to
draw <code>y</code> from a multinomial distribution with parameters
<code>size</code> and <code>prob</code> (where <code>prob</code> will be
a vector of the same length as <code>y</code>) then this can be
implemented as</p>
<pre><code><span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Binomial</span><span class="op">(</span><span class="va">size</span>, <span class="va">prob</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">y</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Binomial</span><span class="op">(</span><span class="va">size</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>while if you want to include a likelihood term where <code>z</code>
is a vector of data (see <a href="https://mrc-ide.github.io/odin2/articles/fitting.html#comparing-against-vectors-of-data">here</a>
for guidance on vectors of data) from a multinomial distribution with
probability vector <code>prob</code>, this can be implemented as</p>
<pre><code><span><span class="va">z</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">~</span> <span class="fu">Binomial</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">prob</span><span class="op">[</span><span class="va">i</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<div class="section level3">
<h3 id="semantics-of-random-number-draws">Semantics of random number draws<a class="anchor" aria-label="anchor" href="#semantics-of-random-number-draws"></a>
</h3>
<p>Stochastic functions are called for each element in an array they are
assigned to, at each time. So here:</p>
<pre><code><span><span class="va">x</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre>
<p><code>x</code> will be filled with each element having a different
draw from a standard normal. In contrast, in:</p>
<pre><code><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">Normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">a</span></span></code></pre>
<p><code>x</code> will be a vector where every element is the same, the
result of a <em>single</em> draw from a standard normal.</p>
</div>
</div>
<div class="section level2">
<h2 id="special-functions">Special functions<a class="anchor" aria-label="anchor" href="#special-functions"></a>
</h2>
<p>There are some special odin functions that may appear on the right
hand side and which must be the only function used in the
expression.</p>
<div class="section level3">
<h3 id="parameters">Parameters<a class="anchor" aria-label="anchor" href="#parameters"></a>
</h3>
<p>The function <code>parameter()</code> introduces a “parameter”;
something that you will initialise your system with, or update after
initialisation. This is the primary mechanism for controlling how
systems behave. The <code>parameter</code> function accepts
arguments:</p>
<ul>
<li>
<code>default</code>: The first argument, typically unnamed, holds
the default value if none is provided at initialisation</li>
<li>
<code>constant</code>: Logical, indicating if the parameter cannot
be changed after being initially set. This must be <code>TRUE</code> for
things leading into array extents</li>
<li>
<code>differentiate</code>: Logical, indicating if the likelihood
(from comparison to data) should be differentiated with respect to this
parameter.</li>
<li>
<code>type</code>: The data type for the variable, as a string. Must
be one of <code>real</code> (the default), <code>integer</code> or
<code>logical</code>.</li>
<li>
<code>rank</code>: The number of dimensions of the parameter. This
is only used when assigning to <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code> (see below)</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Or:</p>
<pre><code><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="fl">12</span>, constant <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"integer"</span><span class="op">)</span></span></code></pre>
<p>There are some interactions among the <code>differentiate</code>
argument combined with <code>constant</code> or <code>type</code>:</p>
<ul>
<li>If a parameter is differentiable (<code>differentiate = TRUE</code>)
it may not be constant!</li>
<li>If <strong>any</strong> parameter is differentiable, the default
value for <code>constant</code> is <code>TRUE</code>, and all
non-constant parameters must be differentiable. Otherwise the default
value for <code>constant</code> is <code>FALSE</code>
</li>
<li>Only parameters with <code>type = "real"</code> can be used with
<code>differentiate = TRUE</code>
</li>
</ul>
<p>If your parameter has its dimensions determined by the size data you
give it, you need to write it slightly specially:</p>
<pre><code><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">parameter</span><span class="op">(</span>rank <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre>
<p>The <code>rank</code> argument here is required because otherwise we
have no information on the number of dimensions that <code>a</code> has;
here by saying <code>rank = 2</code> we specify that <code>a</code> is a
matrix. <em>We might change this interface in future, the implementation
here fairly closely matches that in odin1.</em></p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>If your model compares to data (i.e., it uses <code>~</code>) then it
needs data. These are specified similarly to <code>parameter()</code>,
though at present no arguments are supported.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Unlike <code>parameter()</code>, you will have a series of data
elements, each corresponding to an observation at a different point in
time in a time series. See <code>vignettes("fitting")</code> for more
details.</p>
</div>
<div class="section level3">
<h3 id="interpolation">Interpolation<a class="anchor" aria-label="anchor" href="#interpolation"></a>
</h3>
<p>You can create variables that interpolate against time. This is
useful in a few contexts, for example:</p>
<ul>
<li>A piecewise constant function that represents the level of some
external factor</li>
<li>A smooth function that represents an environmental input</li>
</ul>
<p>Currently all interpolation functions are <em>scalar valued</em>
meaning that at each time a single output is produced.</p>
<p>The usage is:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">interpolate</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, <span class="va">mode</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<code>time</code> is a vector representing time values</li>
<li>
<code>value</code> is a vector representing the series you would
like to interpolate, the same length as <code>time</code>
</li>
<li>
<code>mode</code> is a string, one of <code>constant</code>,
<code>linear</code> or <code>spline</code>
</li>
</ul>
<p>Once complete we will show usage of interpolating functions in their
own vignette.</p>
</div>
</div>
<div class="section level2">
<h2 id="restricted-names">Restricted names<a class="anchor" aria-label="anchor" href="#restricted-names"></a>
</h2>
<p>You cannot assign to a name that is reserved in:</p>
<ul>
<li>
<a href="https://en.cppreference.com/w/cpp/keyword" class="external-link">C++</a> -
includes useful words such as <code>new</code> and
<code>switch</code>
</li>
<li>
<a href="http://en.cppreference.com/w/c/keyword" class="external-link">C</a> - largely a
subset of C++’s words, but also excludes <code>restrict</code>
</li>
<li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#reserved_words" class="external-link">JavaScript</a>
- includes useful words such as <code>default</code> and
<code>export</code>
</li>
<li>A few words restricted by odin itself: <code>time</code>,
<code>dt</code>, <code>parameter</code>, <code>data</code>,
<code>interpolate</code>, <code>delay</code>, <code>initial</code>,
<code>deriv</code>, <code>update</code>, <code>output</code>,
<code>dim</code>, <code>config</code>, <code>state</code>,
<code>state_next</code>, <code>state_deriv</code>, <code>shared</code>,
<code>internal</code>, <code>pi</code>. We may reduce this list in
future.</li>
</ul>
<p>In addition, odin restricts a few prefixes; a name cannot start with
<code>odin_</code>, <code>dim_</code>, <code>interpolate_</code>,
<code>delay_</code> or <code>adjoint_</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
